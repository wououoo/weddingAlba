spring:
  application:
    name: wedding-service
  
  profiles:
    include: file  # file í”„ë¡œí•„ í¬í•¨

  # Jackson ë‚ ì§œ ì§ë ¬í™” ì„¤ì •
  jackson:
    serialization:
      write-dates-as-timestamps: false
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: Asia/Seoul

  # ðŸš€ Kafka ì„±ëŠ¥ ìµœì í™” ì„¤ì •
  kafka:
    bootstrap-servers: localhost:9092
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer
      acks: 1  # all -> 1ë¡œ ë³€ê²½ (ì„±ëŠ¥ í–¥ìƒ)
      retries: 3
      enable-idempotence: true
      batch-size: 16384  # ë°°ì¹˜ í¬ê¸° ì¦ê°€
      linger-ms: 5  # ì§€ì—° ì‹œê°„ ì¶”ê°€ (ë°°ì¹˜ ì²˜ë¦¬ í–¥ìƒ)
      buffer-memory: 33554432  # ë²„í¼ ë©”ëª¨ë¦¬ ì¦ê°€
      compression-type: lz4  # ì••ì¶• ì‚¬ìš©
      max-request-size: 1048576  # ìµœëŒ€ ìš”ì²­ í¬ê¸°
    consumer:
      group-id: chat-group  # ì±„íŒ… ì „ìš© ê·¸ë£¹ ID
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      auto-offset-reset: latest  # earliest -> latestë¡œ ë³€ê²½
      enable-auto-commit: false
      fetch-min-bytes: 1024  # ìµœì†Œ ê°€ì ¸ì˜¬ ë°”ì´íŠ¸
      fetch-max-wait: 500  # ìµœëŒ€ ëŒ€ê¸° ì‹œê°„
      max-poll-records: 50  # í•œë²ˆì— ê°€ì ¸ì˜¬ ë ˆì½”ë“œ ìˆ˜ ì¦ê°€
      session-timeout-ms: 30000  # ì„¸ì…˜ íƒ€ìž„ì•„ì›ƒ
      heartbeat-interval-ms: 10000  # í•˜íŠ¸ë¹„íŠ¸ ê°„ê²©
    listener:
      ack-mode: manual_immediate
      concurrency: 3  # ì»¨ìŠˆë¨¸ ìŠ¤ë ˆë“œ ìˆ˜ (CPU ì½”ì–´ ìˆ˜ì— ë§žê²Œ ì¡°ì •)
      missing-topics-fatal: false
      type: batch  # ë°°ì¹˜ ì²˜ë¦¬ ëª¨ë“œ

  # Redis ì„¤ì •
  redis:
    host: localhost
    port: 6379
    timeout: 3000
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0

  # PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • (Docker Composeìš©)
  datasource:
    url: jdbc:postgresql://localhost:5433/wedding_alba
    username: alba_user
    password: alba_password
    driver-class-name: org.postgresql.Driver
    hikari:
      connection-timeout: 20000
      maximum-pool-size: 20  # í’€ í¬ê¸° ì¦ê°€
      minimum-idle: 5
      idle-timeout: 300000
      max-lifetime: 1800000
      connection-init-sql: SET NAMES 'UTF8'

  # JPA/Hibernate ì„¤ì •
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQL10Dialect
    hibernate:
      ddl-auto: update
    show-sql: false  # ì„±ëŠ¥ì„ ìœ„í•´ falseë¡œ ë³€ê²½
    properties:
      hibernate:
        format_sql: false
        connection:
          charSet: UTF-8
        dialect: org.hibernate.dialect.PostgreSQL10Dialect
        globally_quoted_identifiers: false
        jdbc:
          lob:
            non_contextual_creation: true
          batch_size: 20  # ë°°ì¹˜ ì²˜ë¦¬ í¬ê¸°
        order_inserts: true
        order_updates: true

  # OAuth2 ì„¤ì •
  security:
    oauth2:
      client:
        registration:
          kakao:
            client-id: e74c96df204c836ad89c9edd38c8dd80
            client-secret: SZsrQGv7QrJgPx4HMKbbJ30jt7Bbi1LY
            redirect-uri: "{baseUrl}/login/oauth2/code/kakao"
            authorization-grant-type: authorization_code
            client-authentication-method: client_secret_post
            client-name: Kakao
            scope:
              - profile_nickname
              - account_email
        provider:
          kakao:
            authorization-uri: https://kauth.kakao.com/oauth/authorize
            token-uri: https://kauth.kakao.com/oauth/token
            user-info-uri: https://kapi.kakao.com/v2/user/me
            user-name-attribute: id
        # í† í° ê°±ì‹  ìµœì í™” ì„¤ì •
        http-client:
          connect-timeout: 30s
          read-timeout: 30s
          write-timeout: 30s

# JWT ì„¤ì •
jwt:
  secret: ${JWT_SECRET:wedding-service-jwt-secret-key-which-needs-to-be-at-least-32-bytes-long}
  token-validity-in-seconds: 86400
  refresh-token-validity-in-seconds: 604800

# ë„¤ì´ë²„ ì§€ë„ API ì„¤ì •
naver:
  map:
    client-id: ${NAVER_MAP_CLIENT_ID:your_naver_client_id_here}
    client-secret: ${NAVER_MAP_CLIENT_SECRET:your_naver_client_secret_here}

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¤ìŠ¤í…€ ì„¤ì •
app:
  cors:
    allowed-origins: "http://localhost:3000"
    allowed-methods: GET,POST,PUT,DELETE,OPTIONS
    allowed-headers: "*"
    max-age: 3600

  oauth2:
    redirect-uri: "http://localhost:3000/oauth2/redirect"

# ì„œë²„ ì„¤ì •
server:
  port: 8080
  tomcat:
    relaxed-query-chars: 
      - '['
      - ']'
    threads:
      max: 200  # ìµœëŒ€ ìŠ¤ë ˆë“œ ìˆ˜ ì¦ê°€
      min-spare: 10
  error:
    include-message: always
    include-binding-errors: always

# ë¡œê¹… ì„¤ì •
logging:
  level:
    root: INFO
    wedding: DEBUG
    org.springframework.web: INFO
    org.springframework.data: INFO
    org.springframework.security: INFO  # DEBUG -> INFOë¡œ ë³€ê²½
    org.springframework.security.oauth2: INFO
    org.springframework.web.client.RestTemplate: INFO
    org.hibernate.SQL: INFO  # DEBUG -> INFOë¡œ ë³€ê²½
    org.apache.kafka: INFO
